(function(){"use strict";let w;const H=new Uint8Array(16);function V(){if(!w&&(w=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!w))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return w(H)}const d=[];for(let s=0;s<256;++s)d.push((s+256).toString(16).slice(1));function j(s,t=0){return d[s[t+0]]+d[s[t+1]]+d[s[t+2]]+d[s[t+3]]+"-"+d[s[t+4]]+d[s[t+5]]+"-"+d[s[t+6]]+d[s[t+7]]+"-"+d[s[t+8]]+d[s[t+9]]+"-"+d[s[t+10]]+d[s[t+11]]+d[s[t+12]]+d[s[t+13]]+d[s[t+14]]+d[s[t+15]]}var b={randomUUID:typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function Y(s,t,i){if(b.randomUUID&&!t&&!s)return b.randomUUID();s=s||{};const u=s.random||(s.rng||V)();if(u[6]=u[6]&15|64,u[8]=u[8]&63|128,t){i=i||0;for(let h=0;h<16;++h)t[i+h]=u[h];return t}return j(u)}var T=(s=>(s.CREATE_TASK="create_task",s.CREATE_POOL="create_task_pool",s.COMPLETE_TASK="complete_task",s.COMPLETE_POOL="complete_pool",s.CANCEL_TASK="cancel_task",s.UPDATE_POINT_COST="update_point_cost",s))(T||{});class Z{constructor(t){this.tasks=[],this.results=[],this.id=t}resolve(t){if(this.results.push(t.getResult()),this.results.length===this.tasks.length){const i={idPool:this.id,results:this.results};self.postMessage({event:T.COMPLETE_POOL,payload:i})}}}var A=(s=>(s.INFINITY="INFINITY",s.FLAGS="FLAGS",s))(A||{});const S={width:42,height:48},q={frequencyChange:.2,heightRedistribution:.7,borderSmoothness:.8,falloff:.3};A.INFINITY+"",A.FLAGS+"",S.height/2/S.width,{...S},61/72;function z(s,t){return s.x===t.x&&s.y===t.y}function R(s,t){return Math.hypot(t.x-s.x,t.y-s.y)}function U(s,t){Object.entries(s).forEach(([i,u],h)=>{t(i,u,h)})}function m(s){return Math.abs(s.x)+Math.abs(s.y)!==1}function X(s,t,i){const u={x:s.position.x+t.x,y:s.position.y+t.y},h=i[u.y]?.[u.x]??1;return m(t)?h*Math.SQRT2+(i[s.position.y]?.[u.x]??0)+(i[u.y]?.[s.position.x]??0):h}function $(s){return m(s)?Math.SQRT2:1}function J(s,t){const i={},u={R:{x:1,y:0},L:{x:-1,y:0},D:{x:0,y:1},U:{x:0,y:-1}},h={RD:{x:1,y:1},RU:{x:1,y:-1},LU:{x:-1,y:-1},LD:{x:-1,y:1}},y=[];return U(u,(g,a)=>{const k=t.position.x+a.x,E=t.position.y+a.y;s[E]?.[k]===!1&&(i[g]=!0,y.push(a))}),U(h,(g,a)=>{const k=g.split("").every(L=>i[L]),E=t.position.x+a.x,v=t.position.y+a.y;k&&s[v]?.[E]===!1&&y.push(a)}),y}class W{constructor(){this.pointsCost=[],this.taskQueue=[]}createTask(t){this.taskQueue.push(t)}cancelTask(t){const i=this.taskQueue.findIndex(u=>u.id===t);i!==-1&&this.taskQueue.splice(i,1)}setPointCost(t,i){if(i===null){if(!this.pointsCost[t.y])return;delete this.pointsCost[t.y][t.x]}else this.pointsCost[t.y]||(this.pointsCost[t.y]=[]),this.pointsCost[t.y][t.x]=i}processing(){for(;this.taskQueue.length>0;){const t=this.taskQueue[0],i=t.takeLastNode();if(!i){this.taskQueue.shift(),t.failure();continue}if(z(t.to,i.position)){this.taskQueue.shift(),t.complete(i);continue}i.closeList(),J(t.grid,i).forEach(u=>{t.checkAdjacentNode(i,u,this.pointsCost)})}}}var B=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function tt(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var N={exports:{}};(function(s,t){(function(){var i,u,h,y,g,a,k,E,v,L,G,K,M,O,C;h=Math.floor,L=Math.min,u=function(e,n){return e<n?-1:e>n?1:0},v=function(e,n,o,r,p){var l;if(o==null&&(o=0),p==null&&(p=u),o<0)throw new Error("lo must be non-negative");for(r==null&&(r=e.length);o<r;)l=h((o+r)/2),p(n,e[l])<0?r=l:o=l+1;return[].splice.apply(e,[o,o-o].concat(n)),n},a=function(e,n,o){return o==null&&(o=u),e.push(n),O(e,0,e.length-1,o)},g=function(e,n){var o,r;return n==null&&(n=u),o=e.pop(),e.length?(r=e[0],e[0]=o,C(e,0,n)):r=o,r},E=function(e,n,o){var r;return o==null&&(o=u),r=e[0],e[0]=n,C(e,0,o),r},k=function(e,n,o){var r;return o==null&&(o=u),e.length&&o(e[0],n)<0&&(r=[e[0],n],n=r[0],e[0]=r[1],C(e,0,o)),n},y=function(e,n){var o,r,p,l,c,f;for(n==null&&(n=u),l=function(){f=[];for(var _=0,x=h(e.length/2);0<=x?_<x:_>x;0<=x?_++:_--)f.push(_);return f}.apply(this).reverse(),c=[],r=0,p=l.length;r<p;r++)o=l[r],c.push(C(e,o,n));return c},M=function(e,n,o){var r;if(o==null&&(o=u),r=e.indexOf(n),r!==-1)return O(e,0,r,o),C(e,r,o)},G=function(e,n,o){var r,p,l,c,f;if(o==null&&(o=u),p=e.slice(0,n),!p.length)return p;for(y(p,o),f=e.slice(n),l=0,c=f.length;l<c;l++)r=f[l],k(p,r,o);return p.sort(o).reverse()},K=function(e,n,o){var r,p,l,c,f,_,x,I,D;if(o==null&&(o=u),n*10<=e.length){if(l=e.slice(0,n).sort(o),!l.length)return l;for(p=l[l.length-1],x=e.slice(n),c=0,_=x.length;c<_;c++)r=x[c],o(r,p)<0&&(v(l,r,0,null,o),l.pop(),p=l[l.length-1]);return l}for(y(e,o),D=[],f=0,I=L(n,e.length);0<=I?f<I:f>I;0<=I?++f:--f)D.push(g(e,o));return D},O=function(e,n,o,r){var p,l,c;for(r==null&&(r=u),p=e[o];o>n;){if(c=o-1>>1,l=e[c],r(p,l)<0){e[o]=l,o=c;continue}break}return e[o]=p},C=function(e,n,o){var r,p,l,c,f;for(o==null&&(o=u),p=e.length,f=n,l=e[n],r=2*n+1;r<p;)c=r+1,c<p&&!(o(e[r],e[c])<0)&&(r=c),e[n]=e[r],n=r,r=2*n+1;return e[n]=l,O(e,f,n,o)},i=function(){e.push=a,e.pop=g,e.replace=E,e.pushpop=k,e.heapify=y,e.updateItem=M,e.nlargest=G,e.nsmallest=K;function e(n){this.cmp=n??u,this.nodes=[]}return e.prototype.push=function(n){return a(this.nodes,n,this.cmp)},e.prototype.pop=function(){return g(this.nodes,this.cmp)},e.prototype.peek=function(){return this.nodes[0]},e.prototype.contains=function(n){return this.nodes.indexOf(n)!==-1},e.prototype.replace=function(n){return E(this.nodes,n,this.cmp)},e.prototype.pushpop=function(n){return k(this.nodes,n,this.cmp)},e.prototype.heapify=function(){return y(this.nodes,this.cmp)},e.prototype.updateItem=function(n){return M(this.nodes,n,this.cmp)},e.prototype.clear=function(){return this.nodes=[]},e.prototype.empty=function(){return this.nodes.length===0},e.prototype.size=function(){return this.nodes.length},e.prototype.clone=function(){var n;return n=new e,n.nodes=this.nodes.slice(0),n},e.prototype.toArray=function(){return this.nodes.slice(0)},e.prototype.insert=e.prototype.push,e.prototype.top=e.prototype.peek,e.prototype.front=e.prototype.peek,e.prototype.has=e.prototype.contains,e.prototype.copy=e.prototype.clone,e}(),function(e,n){return s.exports=n()}(this,function(){return i})}).call(B)})(N);var et=N.exports,st=et,nt=tt(st);class Q{constructor({position:t,cost:i=1,distance:u,parent:h=null}){this.listOpened=null,this.position=t,this.distance=u,this.cost=i,this.parent=h}bestGuessDistance(){return this.cost+this.distance}getCost(){return this.cost}setCost(t){this.cost=t}getParent(){return this.parent}setParent(t){this.parent=t}isNewList(){return this.listOpened===null}isListOpened(){return this.listOpened===!0}openList(){this.listOpened=!0}closeList(){this.listOpened=!1}getResult(){const t=[this.position],i=this.parent?.cost??0;let u=this.getParent();for(;u;)t.push(u.position),u=u.getParent();return t.reverse(),{path:t,cost:i}}}class F{constructor({idTask:t,from:i,to:u,grid:h,ignoreCosts:y=!1}){this.tree=[],this.ignoreCosts=!1,this.pool=null,this.id=t,this.from=i,this.to=u,this.grid=h,this.ignoreCosts=y,this.nodes=new nt((a,k)=>a.bestGuessDistance()-k.bestGuessDistance());const g=new Q({position:i,distance:R(i,u)});this.addNode(g)}setPool(t){this.pool||(this.pool=t,this.pool.tasks.push(this))}takeLastNode(){return this.nodes.pop()??null}addNode(t){this.nodes.push(t),this.tree[t.position.y]||(this.tree[t.position.y]=[]),this.tree[t.position.y][t.position.x]=t}pickNode(t){return this.tree[t.y]?.[t.x]}upNode(t){this.nodes.updateItem(t)}failure(){const t={idTask:this.id,result:{path:null,cost:-1}};self.postMessage({event:T.COMPLETE_TASK,payload:t})}complete(t){if(this.pool)this.pool.resolve(t);else{const i={idTask:this.id,result:t.getResult()};self.postMessage({event:T.COMPLETE_TASK,payload:i})}}checkAdjacentNode(t,i,u){const h={x:t.position.x+i.x,y:t.position.y+i.y},y=this.ignoreCosts?$(i):X(t,i,u),g=t.getCost()+y,a=this.pickNode(h);if(a)g<a.getCost()&&(a.setCost(g),a.setParent(t),this.upNode(a));else{const k=new Q({parent:t,position:h,cost:g,distance:R(h,this.to)});k.openList(),this.addNode(k)}}}const P=new W;setInterval(()=>{P.processing()},100),self.onmessage=({data:s})=>{switch(s.event){case T.CREATE_TASK:{const t=s.payload,i=new F(t);P.createTask(i);break}case T.CREATE_POOL:{const t=s.payload,i=new Z(t.idPool);t.entries.forEach(u=>{const h=new F({...t.task,idTask:Y(),to:t.task.to??u,from:t.task.from??u});P.createTask(h),h.setPool(i)});break}case T.CANCEL_TASK:{const t=s.payload;P.cancelTask(t.idTask);break}case T.UPDATE_POINT_COST:{const t=s.payload;P.setPointCost(t.position,t.cost);break}}}})();
